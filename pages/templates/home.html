{% extends 'base.html' %}
{% load static %}

{% block title %}ARENA - AI Safety Curriculum{% endblock %}

{% block extra_css %}
<style>
    /* Modal chapter cards */
    .modal-chapters-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-lg);
    }

    .modal-chapter-card {
        display: flex;
        flex-direction: column;
        padding: var(--spacing-lg);
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
        text-decoration: none;
    }

    .modal-chapter-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--chapter-color);
        opacity: 0;
        transition: opacity var(--transition-fast);
    }

    .modal-chapter-card:hover {
        border-color: var(--chapter-color);
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }

    .modal-chapter-card:hover::before {
        opacity: 1;
    }

    /* Modal overlay */
    .chapter-modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-xl);
    }

    .chapter-modal-overlay.active {
        display: flex;
    }

    .chapter-modal {
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        max-width: 600px;
        width: 100%;
        max-height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-xl);
    }

    .chapter-modal-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--color-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--color-bg-secondary);
    }

    .chapter-modal-header h3 {
        margin: 0;
        font-size: 1.25rem;
    }

    .chapter-modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--color-text-secondary);
        padding: var(--spacing-xs);
        line-height: 1;
    }

    .chapter-modal-close:hover {
        color: var(--color-text);
    }

    .chapter-modal-content {
        flex: 1;
        overflow-y: auto;
        padding: var(--spacing-sm);
    }

    .chapter-modal .section-item {
        display: flex;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius-md);
        text-decoration: none;
        transition: background var(--transition-fast);
    }

    .chapter-modal .section-item:hover {
        background: var(--color-bg-tertiary);
    }

    .chapter-modal .section-number {
        font-family: var(--font-heading);
        font-size: 0.75rem;
        font-weight: 600;
        min-width: 2.5rem;
        padding-top: 2px;
    }

    .chapter-modal .section-info {
        flex: 1;
    }

    .chapter-modal .section-title {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--color-text);
    }

    .chapter-modal .section-desc {
        font-size: 0.75rem;
        color: var(--color-text-secondary);
        margin-top: 2px;
    }

    .chapter-modal-footer {
        padding: var(--spacing-md) var(--spacing-lg);
        border-top: 1px solid var(--color-border);
        text-align: center;
    }

    .chapter-modal-footer a {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-sm) var(--spacing-lg);
        background: var(--modal-chapter-color, var(--color-primary));
        color: white;
        border-radius: var(--radius-md);
        text-decoration: none;
        font-weight: 500;
        transition: opacity var(--transition-fast);
    }

    .chapter-modal-footer a:hover {
        opacity: 0.9;
    }
</style>
{% endblock %}

{% block content %}
<div class="home-container">
    <header class="home-hero">
        <img src="{% static 'images/arena-logo.png' %}" alt="ARENA" class="hero-logo">
        <p class="hero-subtitle">Alignment Research Engineer Accelerator</p>
        <p class="hero-description">
            This is where the ARENA course content is hosted. For more information about the ARENA program,
            including upcoming cohorts and how to apply, visit <a href="https://arena.education" target="_blank" rel="noopener">arena.education</a>.
        </p>
    </header>

    <section class="modal-chapters-grid">
        {% for chapter in chapters %}
        <div class="modal-chapter-card"
             style="--chapter-color: {{ chapter.color }}"
             data-modal-chapter-id="{{ chapter.id }}"
             data-chapter-color="{{ chapter.color }}"
             data-chapter-title="{{ chapter.short_title }}">
            <div class="card-header">
                <span class="card-number">{{ forloop.counter0 }}</span>
                <div class="card-icon" aria-hidden="true">
                    {% if chapter.icon == 'foundation' %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                        <path d="M12 12h.01"></path>
                        <path d="M17 12h.01"></path>
                        <path d="M7 12h.01"></path>
                    </svg>
                    {% elif chapter.icon == 'microscope' %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 18h8"></path>
                        <path d="M3 22h18"></path>
                        <path d="M14 22a7 7 0 1 0 0-14h-1"></path>
                        <path d="M9 14h2"></path>
                        <path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"></path>
                        <path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"></path>
                    </svg>
                    {% elif chapter.icon == 'gamepad' %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="6" y1="12" x2="10" y2="12"></line>
                        <line x1="8" y1="10" x2="8" y2="14"></line>
                        <line x1="15" y1="13" x2="15.01" y2="13"></line>
                        <line x1="18" y1="11" x2="18.01" y2="11"></line>
                        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                    </svg>
                    {% elif chapter.icon == 'clipboard-check' %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <path d="M9 14l2 2 4-4"></path>
                    </svg>
                    {% endif %}
                </div>
            </div>
            <h2 class="card-title">{{ chapter.short_title }}</h2>
            <p class="card-description">{{ chapter.description }}</p>
            <div class="card-footer">
                <span class="section-count">{{ chapter.section_count }} sections</span>
                <span class="card-arrow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </span>
            </div>
        </div>
        {% endfor %}
    </section>

    <!-- NOTE: Please do not remove this section in future edits -->
    <!-- <section class="quality-section">
        <p class="quality-text">
            To avoid the slopification of learning, we ensure that every chapter of content is written and reviewed by domain experts. We regularly add to the material to keep pace with new fields in AI safety.
        </p>
        <img src="{% static 'images/gptzero.png' %}" alt="Human-written content verification" class="quality-image">
        <p class="quality-text">
            Join our Slack group <a href="https://join.slack.com/t/arena-uk/shared_invite/zt-39iwnhbj4-pMWUvZkkt2wpvkvJ0q2rRQ"><u>here</u></a> to ask questions / discuss the material!
        </p>
    </section> -->
</div>

<!-- Modal overlay -->
<div class="chapter-modal-overlay" id="chapter-modal-overlay">
    <div class="chapter-modal">
        <div class="chapter-modal-header">
            <h3 id="modal-title">Chapter Title</h3>
            <button class="chapter-modal-close" id="modal-close">&times;</button>
        </div>
        <div class="chapter-modal-content" id="modal-content">
            <!-- Sections will be populated here -->
        </div>
        <div class="chapter-modal-footer">
            <a href="#" id="modal-go-to-chapter">
                Go to Chapter
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
            </a>
        </div>
    </div>
</div>

<!-- Hidden section data for modal -->
{% for chapter in chapters %}
<template id="modal-sections-{{ chapter.id }}">
    {% for section in chapter.sections %}
    {% if not section.is_group %}
    <a href="/{{ chapter.id }}/{{ section.id }}/" class="section-item">
        <span class="section-number" style="color: {{ chapter.color }}">{{ section.number }}</span>
        <div class="section-info">
            <div class="section-title">{{ section.title }}</div>
            <div class="section-desc">{{ section.streamlit_description_short }}</div>
        </div>
    </a>
    {% endif %}
    {% endfor %}
</template>
{% endfor %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modalCards = document.querySelectorAll('.modal-chapter-card');
    const modalOverlay = document.getElementById('chapter-modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalContent = document.getElementById('modal-content');
    const modalClose = document.getElementById('modal-close');
    const modalGoTo = document.getElementById('modal-go-to-chapter');

    modalCards.forEach(card => {
        card.addEventListener('click', function() {
            const chapterId = this.dataset.modalChapterId;
            const chapterColor = this.dataset.chapterColor;
            const title = this.dataset.chapterTitle;

            // Update modal
            modalTitle.textContent = title;
            modalGoTo.href = '/' + chapterId + '/';
            modalGoTo.style.background = chapterColor;

            // Get sections from template
            const template = document.getElementById('modal-sections-' + chapterId);
            if (template) {
                modalContent.innerHTML = template.innerHTML;
            }

            // Show modal
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    });

    // Close modal
    function closeModal() {
        modalOverlay.classList.remove('active');
        document.body.style.overflow = '';
    }

    modalClose.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
            closeModal();
        }
    });
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });
});
</script>
{% endblock %}
